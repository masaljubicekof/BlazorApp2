@page "/login"
@inject SupaClient Supa
@inject AppState State

<h3>Login</h3>

<div class="mb-3">
    <label class="form-label">Email</label>
    <input class="form-control" @bind="email" placeholder="Enter email" />
</div>

<div class="mb-3">
    <label class="form-label">Password</label>
    <input class="form-control" @bind="password" type="password" placeholder="Enter password" />
</div>

<button class="btn btn-success" @onclick="DoLogin">Login</button>

@if (!string.IsNullOrWhiteSpace(msg))
{
    <div class="alert alert-info alert-dismissible fade show mt-3" role="alert">
        @msg
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}



@code {
    string email="", password="", msg="";
    async Task DoLogin() {
        try {
            var r = await Supa.Login(email, password);
            if (r?.AccessToken != null) {
                State.CurrentUserId = Jwt.GetUserIdFromToken(r.AccessToken);
                msg = $"Ulogovan: {r.User?.Email} ({State.CurrentUserId})";
            }
        } catch(Exception ex){ msg = ex.Message; }
    }
}
